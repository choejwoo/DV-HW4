<!DOCTYPE html>

<html lang="en" dir="ltr">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link rel="stylesheet" href="DayandNight.css" type="text/css">

<head>
  <meta charset="utf-8">
  <title>교통사고 사상자 통계 분석 페이지</title>
</head>

<body>

  <script src="https://d3js.org/d3.v4.min.js"></script>



  <nav class="navbar navbar-expand-lg navbar-dark bg-primary" style="font: bold">
    <a class="navbar-brand" href="#"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>


    <div class="collapse navbar-collapse" id="navbarColor01">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/Home.html">홈</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/DayandNight.html">주, 야간 <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/CarClassification.html">차량 종류</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/Population.html">인구 수</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/RoadType.html">도로 형태</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/Map.html">지역</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/OverallAnalysis.html">종합</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container" style="margin-top : 25px">
    <h1>2017년도 주,야간 요일 별 사망사고 수</h1>

    <svg width="800" height="500"></svg>

    <script>
      var dayofNight = [];
      var dayofNoon = [];

      var daycount = 0;

      d3.csv("DV/accidents.csv", function(error, data) {


        data.forEach(function(d) {
          if (d.요일 == "월" && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '월',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '화' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '화',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '수' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '수',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '목' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '목',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '금' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '금',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '토' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '토',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '일' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '일',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == "월" && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '월',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '화' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '화',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '수' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '수',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '목' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '목',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '금' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '금',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '토' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '토',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '일' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '일',
          y: daycount
        });
        daycount = 0;

        console.log(dayofNight);

        var svg = d3.select("svg");
        var width = parseInt(svg.style("width"), 10) - 30;
        var height = parseInt(svg.style("height"), 10) - 20;

        var svgG = svg.append("g")
          .attr("transform", "translate(30,0)");

        var svgG2 = svg.append("g")
          .attr("transform", "translate(30,0)");

        var yScale = d3.scaleLinear()
          .domain([0, d3.max(dayofNoon, function(d) {
            return d.y;
          })])
          .range([height, 30]);

        var xScale = d3.scaleBand()
          .domain(dayofNoon.map(function(d) {
            return d.x;
          }))
          .range([0, width]).padding(0, 50);

        svgG.selectAll("rect")
          .data(dayofNoon)
          .enter().append("rect")
          .attr("class", "bar")
          .attr("height", function(d, i) {
            return height - yScale(d.y)
          })
          .attr("width", xScale.bandwidth() - 80)
          .attr("x", function(d, i) {
            return xScale(d.x) + 25
          })
          .attr("y", function(d, i) {
            return yScale(d.y)
          });

        svgG.selectAll("text")
          .data(dayofNoon)
          .enter().append("text")
          .text(function(d) {
            return d.y
          })
          .attr("x", function(d, i) {
            return xScale(d.x) + xScale.bandwidth() / 2 - 15
          })
          .style("text-anchor", "middle")
          .attr("y", function(d, i) {
            return yScale(d.y) + 15
          });


        svgG2.selectAll("rect")
          .data(dayofNight)
          .enter().append("rect")
          .attr("class", "bar2")
          .attr("height", function(d, i) {
            return height - yScale(d.y)
          })
          .attr("width", xScale.bandwidth() - 80)
          .attr("x", function(d, i) {
            return xScale(d.x) + 55
          })
          .attr("y", function(d, i) {
            return yScale(d.y)
          });

        svgG2.selectAll("text")
          .data(dayofNight)
          .enter().append("text")
          .text(function(d) {
            return d.y
          })
          .attr("x", function(d, i) {
            return xScale(d.x) + xScale.bandwidth() / 2 + 15
          })
          .style("text-anchor", "middle")
          .attr("y", function(d, i) {
            return yScale(d.y) + 15
          });


        svgG.append("g")
          .attr("transform", "translate(0," + (height) + ")")
          .call(d3.axisBottom(xScale));

        svgG.append("g")
          .call(d3.axisLeft(yScale).ticks(5));

      });
    </script>
    <div class="dayBox">
      <div style="margin-left : 25px">DayTime</div>
    </div>

    <div class="nightBox">
      <div style="margin-left : 25px">NightTime</div>
    </div>

  </div>

  <div class="container" style="margin-top : 25px; margin-bottom : 50px">

    <h1>2015 ~ 2018년도 차량 별 주야간 사망사고 수</h1>
    <div id="my_dataviz"></div>
    <p style="margin-left:50px">X:차종 Y:사고수</p>
    <table height="10px" width="10px" style="background-color:#f4a582; float:left; margin-left:50px;margin-right:2px"></table>
    <div>주간 (06:00 ~ 17:59)</div>
    <table height="10px" width="10px" style="background-color:#92c5de; float:left; margin-left:50px;margin-right:2px"></table>
    <div>야간 (18:00 ~ 05:59)</div>
    <script>
      // set the dimensions and margins of the graph
      var margin = {
          top: 10,
          right: 30,
          bottom: 20,
          left: 50
        },
        width = 700 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      // Parse the Data
      d3.csv("DV3/dataSet.csv", function(data) {
        var count = [0, 0, 0, 0, 0, 0];

        data.forEach(function(d) {
          if (d.가해자_당사자종별_대분류 == "승용차") {
            if (d.주야 == "주간") {
              count[0]++;
            } else if (d.주야 == "야간") {
              count[1]++;
            }
          } else if (d.가해자_당사자종별_대분류 == "화물차") {
            if (d.주야 == "주간") {
              count[2]++;
            } else if (d.주야 == "야간") {
              count[3]++;
            }
          } else if (d.가해자_당사자종별_대분류 == "이륜차") {
            if (d.주야 == "주간") {
              count[4]++;
            } else if (d.주야 == "야간") {
              count[5]++;
            }
          }
        });

        var countedData = [];

        // List of subgroups = header of the csv files = soil condition here
        //var subgroups = data.columns.slice(1)
        var subgroups = ["주", "야"]

        // List of groups = species here = value of the first column called group -> I show them on the X axis
        var groups = ["승용차", "화물차", "이륜차"];

        countedData.push({
          group: '승합차',
          주: count[0],
          야: count[1]
        });
        countedData.push({
          group: '화물차',
          주: count[2],
          야: count[3]
        });
        countedData.push({
          group: '이륜차',
          주: count[4],
          야: count[5]
        });

        // Add X axis
        var x = d3.scaleBand()
          .domain(groups)
          .range([0, width])
          .padding([0.2])
        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x).tickSizeOuter(0));

        // Add Y axis
        var y = d3.scaleLinear()
          .domain([0, 9000])
          .range([height, 0]);
        svg.append("g")
          .call(d3.axisLeft(y));

        // color palette = one color per subgroup
        var color = d3.scaleOrdinal()
          .domain(subgroups)
          .range(['#f4a582', '#92c5de'])

        //stack the data? --> stack per subgroup
        var stackedData = d3.stack()
          .keys(subgroups)
          (countedData)

        // Show the bars
        svg.append("g")
          .selectAll("g")
          // Enter in the stack data = loop key per key = group per group
          .data(stackedData)
          .enter().append("g")
          .attr("fill", function(d) {
            return color(d.key);
          })
          .selectAll("rect")
          // enter a second time = loop subgroup per subgroup to add all rectangles
          .data(function(d) {
            return d;
          })
          .enter().append("rect")
          .attr("x", function(d) {
            if(x(d.data.group) == null)
            return 60;
            else return x(d.data.group) +20;
          })
          .attr("y", function(d) {
            return y(d[1]);
          })
          .attr("height", function(d) {
            return y(d[0]) - y(d[1]);
          })
          .attr("width", x.bandwidth() -40)
      })
    </script>
  </div>
</body>

</html>
