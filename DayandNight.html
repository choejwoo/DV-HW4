<!DOCTYPE html>

<html lang="en" dir="ltr">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link rel="stylesheet" href="DayandNight.css" type="text/css">

<head>
  <meta charset="utf-8">
  <title>교통사고 사상자 통계 분석 페이지</title>
</head>

<body >

  <script src="https://d3js.org/d3.v4.min.js"></script>



  <nav class="navbar navbar-expand-lg navbar-dark bg-primary" style="font: bold">
    <a class="navbar-brand" href="#"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>


    <div class="collapse navbar-collapse" id="navbarColor01">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/Home.html">홈</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/DayandNight.html">주, 야간 <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/CarClassification.html">차량 종류</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/Population.html">인구 수</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/RoadType.html">도로 형태</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/Map.html">지역</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://choejwoo.github.io/DV-HW4/OverallAnalysis.html">종합</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container" style="margin-top : 25px">
    <h1>2017년도 주,야간 요일 별 사망사고 수</h1>

    <svg width="800" height="500"></svg>

    <script>
      var dayofNight = [];
      var dayofNoon = [];

      var daycount = 0;

      d3.csv("DV/accidents.csv", function(error, data) {


        data.forEach(function(d) {
          if (d.요일 == "월" && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '월',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '화' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '화',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '수' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '수',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '목' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '목',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '금' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '금',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '토' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '토',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '일' && d.주야 == "주간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNoon.push({
          x: '일',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == "월" && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '월',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '화' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '화',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '수' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '수',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '목' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '목',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '금' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '금',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '토' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '토',
          y: daycount
        });
        daycount = 0;

        data.forEach(function(d) {
          if (d.요일 == '일' && d.주야 == "야간")
            daycount = daycount + parseInt(d.사망자수);
        });
        dayofNight.push({
          x: '일',
          y: daycount
        });
        daycount = 0;

        console.log(dayofNight);

        var svg = d3.select("svg");
        var width = parseInt(svg.style("width"), 10) - 30;
        var height = parseInt(svg.style("height"), 10) - 20;

        var svgG = svg.append("g")
          .attr("transform", "translate(30,0)");

        var svgG2 = svg.append("g")
          .attr("transform", "translate(30,0)");

        var yScale = d3.scaleLinear()
          .domain([0, d3.max(dayofNoon, function(d) {
            return d.y;
          })])
          .range([height, 30]);

        var xScale = d3.scaleBand()
          .domain(dayofNoon.map(function(d) {
            return d.x;
          }))
          .range([0, width]).padding(0, 50);

        svgG.selectAll("rect")
          .data(dayofNoon)
          .enter().append("rect")
          .attr("class", "bar")
          .attr("height", function(d, i) {
            return height - yScale(d.y)
          })
          .attr("width", xScale.bandwidth() - 80)
          .attr("x", function(d, i) {
            return xScale(d.x) + 25
          })
          .attr("y", function(d, i) {
            return yScale(d.y)
          });

        svgG.selectAll("text")
          .data(dayofNoon)
          .enter().append("text")
          .text(function(d) {
            return d.y
          })
          .attr("x", function(d, i) {
            return xScale(d.x) + xScale.bandwidth() / 2 - 15
          })
          .style("text-anchor", "middle")
          .attr("y", function(d, i) {
            return yScale(d.y) + 15
          });


        svgG2.selectAll("rect")
          .data(dayofNight)
          .enter().append("rect")
          .attr("class", "bar2")
          .attr("height", function(d, i) {
            return height - yScale(d.y)
          })
          .attr("width", xScale.bandwidth() - 80)
          .attr("x", function(d, i) {
            return xScale(d.x) + 55
          })
          .attr("y", function(d, i) {
            return yScale(d.y)
          });

        svgG2.selectAll("text")
          .data(dayofNight)
          .enter().append("text")
          .text(function(d) {
            return d.y
          })
          .attr("x", function(d, i) {
            return xScale(d.x) + xScale.bandwidth() / 2 + 15
          })
          .style("text-anchor", "middle")
          .attr("y", function(d, i) {
            return yScale(d.y) + 15
          });


        svgG.append("g")
          .attr("transform", "translate(0," + (height) + ")")
          .call(d3.axisBottom(xScale));

        svgG.append("g")
          .call(d3.axisLeft(yScale).ticks(5));

      });
    </script>
    <div class="dayBox">
      <div style="margin-left : 25px">DayTime</div>
    </div>

    <div class="nightBox">
      <div style="margin-left : 25px">NightTime</div>
    </div>

      <p>
        요일별로 나누었을 때, 총 사망자의 수는 요일과 관계없이 비슷합니다.
      </p>
      <p>
        하지만, 평일에서 주말에 가까워질수록 야간 사망자 수가 증가하는 것을 볼 수 있습니다.
        </p>

  </div>

  <div class="container" style="margin-top : 25px; margin-bottom : 50px">

    <h1>2015 ~ 2018년도 차량 별 주야간 사망사고 수</h1>
    <div id="my_dataviz1"></div>
    <p style="margin-left:50px">X:차종 Y:사고수</p>
    <table height="10px" width="10px" style="background-color:#f4a582; float:left; margin-left:50px;margin-right:2px"></table>
    <div>주간 (06:00 ~ 17:59)</div>
    <table height="10px" width="10px" style="background-color:#92c5de; float:left; margin-left:50px;margin-right:2px"></table>
    <div>야간 (18:00 ~ 05:59)</div>
    <p>
      명하1
    </p>
    <p>
      명하2
      </p>
    <script>
      // set the dimensions and margins of the graph
      var margin = {
          top: 10,
          right: 30,
          bottom: 20,
          left: 50
        },
        width = 700 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz1")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      // Parse the Data
      d3.csv("DV3/dataSet.csv", function(data) {
        var count = [0, 0, 0, 0, 0, 0];

        data.forEach(function(d) {
          if (d.가해자_당사자종별_대분류 == "승용차") {
            if (d.주야 == "주간") {
              count[0]++;
            } else if (d.주야 == "야간") {
              count[1]++;
            }
          } else if (d.가해자_당사자종별_대분류 == "화물차") {
            if (d.주야 == "주간") {
              count[2]++;
            } else if (d.주야 == "야간") {
              count[3]++;
            }
          } else if (d.가해자_당사자종별_대분류 == "이륜차") {
            if (d.주야 == "주간") {
              count[4]++;
            } else if (d.주야 == "야간") {
              count[5]++;
            }
          }
        });

        var countedData = [];

        // List of subgroups = header of the csv files = soil condition here
        //var subgroups = data.columns.slice(1)
        var subgroups = ["주", "야"]

        // List of groups = species here = value of the first column called group -> I show them on the X axis
        var groups = ["승용차", "화물차", "이륜차"];

        countedData.push({
          group: '승합차',
          주: count[0],
          야: count[1]
        });
        countedData.push({
          group: '화물차',
          주: count[2],
          야: count[3]
        });
        countedData.push({
          group: '이륜차',
          주: count[4],
          야: count[5]
        });

        // Add X axis
        var x = d3.scaleBand()
          .domain(groups)
          .range([0, width])
          .padding([0.2])
        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x).tickSizeOuter(0));

        // Add Y axis
        var y = d3.scaleLinear()
          .domain([0, 9000])
          .range([height, 0]);
        svg.append("g")
          .call(d3.axisLeft(y));

        // color palette = one color per subgroup
        var color = d3.scaleOrdinal()
          .domain(subgroups)
          .range(['#f4a582', '#92c5de'])

        //stack the data? --> stack per subgroup
        var stackedData = d3.stack()
          .keys(subgroups)
          (countedData)

        // Show the bars
        svg.append("g")
          .selectAll("g")
          // Enter in the stack data = loop key per key = group per group
          .data(stackedData)
          .enter().append("g")
          .attr("fill", function(d) {
            return color(d.key);
          })
          .selectAll("rect")
          // enter a second time = loop subgroup per subgroup to add all rectangles
          .data(function(d) {
            return d;
          })
          .enter().append("rect")
          .attr("x", function(d) {
            if (x(d.data.group) == null)
              return 60;
            else return x(d.data.group) + 20;
          })
          .attr("y", function(d) {
            return y(d[1]);
          })
          .attr("height", function(d) {
            return y(d[0]) - y(d[1]);
          })
          .attr("width", x.bandwidth() - 40)
      })
    </script>
  </div>

  <div class="container">

    <h1>2015 ~ 2018년도 차량 별 시간에 따른 사망사고 수</h1>

    <!-- Create a div where the graph will take place -->
    <div id="my_dataviz"></div>

    <p style="margin-left:50px">X:시간 Y:사고수</p>
    <p>
      명하1
    </p>
    <p>
      명하2
      </p>
    <!-- Color Scale -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <script>
      // set the dimensions and margins of the graph
      var margin = {
          top: 10,
          right: 100,
          bottom: 30,
          left: 30
        },
        width = 800 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

      // append the svg3 object to the body of the page
      var svg3 = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      //Read the data
      //d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_connectedscatter.csv", function(data) {
      d3.csv("DV3/dataSet.csv", function(data) {
        // List of groups (here I have one group per column)
        var allGroup = ["승용차", "화물차", "이륜차"]

        //달별 사고량 계산
        var monthAccident1 = [
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
        ];

        var monthAccident2 = [
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
        ];

        var monthAccident3 = [
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0,
        ];


        var parseTime = d3.timeParse("%H:%M");
        var formatTime = d3.timeFormat("%H");

        data.forEach(function(d) {
          var myString = d.발생년월일시분;
          var splits = myString.split(' ');

          t = parseTime(splits[1]);
          var hour = formatTime(t);

          if (d.가해자_당사자종별_대분류 == "승용차") {
            if (hour == '00') {
              monthAccident1[0]++;
            } else if (hour == '01') {
              monthAccident1[1]++;
            } else if (hour == '02') {
              monthAccident1[2]++;
            } else if (hour == '03') {
              monthAccident1[3]++;
            } else if (hour == '04') {
              monthAccident1[4]++;
            } else if (hour == '05') {
              monthAccident1[5]++;
            } else if (hour == '06') {
              monthAccident1[6]++;
            } else if (hour == '07') {
              monthAccident1[7]++;
            } else if (hour == '08') {
              monthAccident1[8]++;
            } else if (hour == '09') {
              monthAccident1[9]++;
            } else if (hour == '10') {
              monthAccident1[10]++;
            } else if (hour == '11') {
              monthAccident1[11]++;
            } else if (hour == '12') {
              monthAccident1[12]++;
            } else if (hour == '13') {
              monthAccident1[13]++;
            } else if (hour == '14') {
              monthAccident1[14]++;
            } else if (hour == '15') {
              monthAccident1[15]++;
            } else if (hour == '16') {
              monthAccident1[16]++;
            } else if (hour == '17') {
              monthAccident1[17]++;
            } else if (hour == '18') {
              monthAccident1[18]++;
            } else if (hour == '19') {
              monthAccident1[19]++;
            } else if (hour == '20') {
              monthAccident1[20]++;
            } else if (hour == '21') {
              monthAccident1[21]++;
            } else if (hour == '22') {
              monthAccident1[22]++;
            } else if (hour == '23') {
              monthAccident1[23]++;
            }
          } else if (d.가해자_당사자종별_대분류 == "화물차") {
            if (hour == '00') {
              monthAccident2[0]++;
            } else if (hour == '01') {
              monthAccident2[1]++;
            } else if (hour == '02') {
              monthAccident2[2]++;
            } else if (hour == '03') {
              monthAccident2[3]++;
            } else if (hour == '04') {
              monthAccident2[4]++;
            } else if (hour == '05') {
              monthAccident2[5]++;
            } else if (hour == '06') {
              monthAccident2[6]++;
            } else if (hour == '07') {
              monthAccident2[7]++;
            } else if (hour == '08') {
              monthAccident2[8]++;
            } else if (hour == '09') {
              monthAccident2[9]++;
            } else if (hour == '10') {
              monthAccident2[10]++;
            } else if (hour == '11') {
              monthAccident2[11]++;
            } else if (hour == '12') {
              monthAccident2[12]++;
            } else if (hour == '13') {
              monthAccident2[13]++;
            } else if (hour == '14') {
              monthAccident2[14]++;
            } else if (hour == '15') {
              monthAccident2[15]++;
            } else if (hour == '16') {
              monthAccident2[16]++;
            } else if (hour == '17') {
              monthAccident2[17]++;
            } else if (hour == '18') {
              monthAccident2[18]++;
            } else if (hour == '19') {
              monthAccident2[19]++;
            } else if (hour == '20') {
              monthAccident2[20]++;
            } else if (hour == '21') {
              monthAccident2[21]++;
            } else if (hour == '22') {
              monthAccident2[22]++;
            } else if (hour == '23') {
              monthAccident2[23]++;
            }
          } else if (d.가해자_당사자종별_대분류 == "이륜차") {
            if (hour == '00') {
              monthAccident3[0]++;
            } else if (hour == '01') {
              monthAccident3[1]++;
            } else if (hour == '02') {
              monthAccident3[2]++;
            } else if (hour == '03') {
              monthAccident3[3]++;
            } else if (hour == '04') {
              monthAccident3[4]++;
            } else if (hour == '05') {
              monthAccident3[5]++;
            } else if (hour == '06') {
              monthAccident3[6]++;
            } else if (hour == '07') {
              monthAccident3[7]++;
            } else if (hour == '08') {
              monthAccident3[8]++;
            } else if (hour == '09') {
              monthAccident3[9]++;
            } else if (hour == '10') {
              monthAccident3[10]++;
            } else if (hour == '11') {
              monthAccident3[11]++;
            } else if (hour == '12') {
              monthAccident3[12]++;
            } else if (hour == '13') {
              monthAccident3[13]++;
            } else if (hour == '14') {
              monthAccident3[14]++;
            } else if (hour == '15') {
              monthAccident3[15]++;
            } else if (hour == '16') {
              monthAccident3[16]++;
            } else if (hour == '17') {
              monthAccident3[17]++;
            } else if (hour == '18') {
              monthAccident3[18]++;
            } else if (hour == '19') {
              monthAccident3[19]++;
            } else if (hour == '20') {
              monthAccident3[20]++;
            } else if (hour == '21') {
              monthAccident3[21]++;
            } else if (hour == '22') {
              monthAccident3[22]++;
            } else if (hour == '23') {
              monthAccident3[23]++;
            }
          }
        });


        var testData = [];

        for (var i = 0; i < 24; i++) {
          testData.push({
            time: i + 1,
            '승용차': monthAccident1[i],
            '화물차': monthAccident2[i],
            '이륜차': monthAccident3[i]
          });
        }

        // Reformat the data: we need an array of arrays of {x, y} tuples
        var dataReady = allGroup.map(function(grpName) { // .map allows to do something for each element of the list
          return {
            name: grpName,
            values: testData.map(function(d) {

              return {
                time: d.time,
                value: +d[grpName]
              };
            })
          };
        });
        // I strongly advise to have a look to dataReady with
        // console.log(dataReady)


        // A color scale: one color for each group
        var myColor = d3.scaleOrdinal()
          .domain(allGroup)
          .range(d3.schemeSet2);

        // Add X axis --> it is a date format
        var x = d3.scaleLinear()
          .domain([0, 24])
          .range([0, width])

        svg3.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x).ticks(24))

        // Add Y <axis></axis>
        var y = d3.scaleLinear()
          .domain([0, 600])
          .range([height, 0]);
        svg3.append("g")
          .call(d3.axisLeft(y).ticks(15))

        // Add the lines
        var line = d3.line()
          .x(function(d) {
            return x(+d.time)
          })
          .y(function(d) {
            return y(+d.value)
          })
        svg3.selectAll("myLines")
          .data(dataReady)
          .enter()
          .append("path")
          .attr("d", function(d) {
            return line(d.values)
          })
          .attr("stroke", function(d) {
            return myColor(d.name)
          })
          .style("stroke-width", 2)
          .style("fill", "none")

        //툴 팁


        // Add the points
        svg3
          // First we need to enter in a group
          .selectAll("myDots")
          .data(dataReady)
          .enter()
          .append('g')
          .style("fill", function(d) {
            return myColor(d.name)
          })
          // Second we need to enter in the 'values' part of this group
          .selectAll("myPoints")
          .data(function(d) {
            return d.values
          })
          .enter()
          .append("circle")
          .attr("cx", function(d) {
            return x(d.time)
          })
          .attr("cy", function(d) {
            return y(d.value)
          })
          .attr("r", 3)
          .attr("stroke", "white")


        // Add a legend at the end of each line
        svg3
          .selectAll("myLabels")
          .data(dataReady)
          .enter()
          .append('g')
          .append("text")
          .datum(function(d) {
            return {
              name: d.name,
              value: d.values[d.values.length - 1]
            };
          }) // keep only the last value of each time series
          .attr("transform", function(d) {
            return "translate(" + x(d.value.time) + "," + y(d.value.value) + ")";
          }) // Put the text at the position of the last point
          .attr("x", 12) // shift the text a bit more right
          .text(function(d) {
            return d.name;
          })
          .style("fill", function(d) {
            return myColor(d.name)
          })
          .style("font-size", 15)

      })
    </script>


  </div>
</body>

</html>
